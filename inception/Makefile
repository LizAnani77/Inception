CLEAN_COLOR     = \033[38;5;198m
REMOVE_COLOR    = \033[38;5;201m
COMPILE_COLOR   = \033[38;5;207m
BOX_COLOR       = \033[38;5;219m
SUCCESS_COLOR   = \033[38;5;46m
INFO_COLOR      = \033[38;5;51m
RESET           = \033[0m

PROJECT_NAME    = inception
COMPOSE_FILE    = srcs/docker-compose.yml
ENV_FILE        = srcs/.env
DATA_PATH       = $(HOME)/data

all: up


up:
	@echo "$(BOX_COLOR)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(RESET)"
	@echo "$(BOX_COLOR)â•‘          Starting Inception Project        â•‘$(RESET)"
	@echo "$(BOX_COLOR)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)"
	@echo "$(INFO_COLOR)ğŸ“ Creating data directories...$(RESET)"
	@mkdir -p $(DATA_PATH)/mariadb
	@mkdir -p $(DATA_PATH)/wordpress
	@mkdir -p $(DATA_PATH)/static
	@echo "$(COMPILE_COLOR)ğŸ³ Building and starting containers...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) --env-file $(ENV_FILE) up -d $(QUIET)
	@echo "$(SUCCESS_COLOR)âœ… Inception is now running!$(RESET)"
	@echo "$(INFO_COLOR)ğŸŒ WordPress          â†’ https://lanani-f.42.fr$(RESET)"
	@echo "$(INFO_COLOR)ğŸ“„ Static Site        â†’ https://static.lanani-f.42.fr$(RESET)"
	@echo "$(INFO_COLOR)ğŸ§­ Portainer          â†’ https://portainer.lanani-f.42.fr$(RESET)"
	@echo "$(INFO_COLOR)ğŸ—‚ï¸  Adminer            â†’ https://adminer.lanani-f.42.fr$(RESET)"
	@echo "$(INFO_COLOR)ğŸ§‘â€ğŸ’» WordPress admin  â†’ https://lanani-f.42.fr/wp-admin$(RESET)"


down:
	@echo "$(CLEAN_COLOR)ğŸ›‘ Stopping Inception containers...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) down $(QUIET)
	@echo "$(SUCCESS_COLOR)âœ… All containers stopped$(RESET)"


restart:
	@echo "$(INFO_COLOR)ğŸ”„ Restarting Inception containers...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) restart $(QUIET)
	@echo "$(SUCCESS_COLOR)âœ… Containers restarted$(RESET)"


logs:
	@echo "$(INFO_COLOR)ğŸ“‹ Showing container logs...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) logs


build:
	@echo "$(BOX_COLOR)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(RESET)"
	@echo "$(BOX_COLOR)â•‘            Building Docker Images          â•‘$(RESET)"
	@echo "$(BOX_COLOR)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)"
	@echo "$(COMPILE_COLOR)ğŸ”¨ Building all Docker images...$(RESET)"

	@DOCKER_BUILDKIT=0 docker compose -f $(COMPOSE_FILE) build > /dev/null 2>&1
	@echo "$(SUCCESS_COLOR)âœ… All images built successfully!$(RESET)"


clean:
	@echo "$(CLEAN_COLOR)ğŸ§¹ Cleaning containers and volumes...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) down -v $(QUIET)
	@docker system prune -af $(QUIET)
	@echo "$(SUCCESS_COLOR)âœ… Cleanup completed$(RESET)"


fclean: clean
	@echo "$(BOX_COLOR)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(RESET)"
	@echo "$(BOX_COLOR)â•‘           Full Cleanup Started             â•‘$(RESET)"
	@echo "$(BOX_COLOR)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)"
	@echo "$(REMOVE_COLOR)ğŸ—‘ï¸  Removing all containers and volumes...$(RESET)"
	@docker compose -f $(COMPOSE_FILE) down $(QUIET)
	@docker system prune -af $(QUIET)
	@echo "$(REMOVE_COLOR)ğŸ—‘ï¸  Cleaning data directories...$(RESET)"
	@docker run --rm -v $(DATA_PATH):/data alpine:3.21 sh -c "rm -rf /data/mariadb /data/static" $(QUIET)
	@echo "$(SUCCESS_COLOR)âœ… Full cleanup completed!$(RESET)"


re: fclean all


status:
	@echo "$(INFO_COLOR)ğŸ“Š Inception Project Status:$(RESET)"
	@echo "$(INFO_COLOR)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(RESET)"
	@docker compose -f $(COMPOSE_FILE) ps $(QUIET)
	@cd srcs/requirements/tools && ./health_check.sh


help:
	@echo "$(BOX_COLOR)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(RESET)"
	@echo "$(BOX_COLOR)â•‘              Inception Makefile            â•‘$(RESET)"
	@echo "$(BOX_COLOR)â•‘                Help Menu                   â•‘$(RESET)"
	@echo "$(BOX_COLOR)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)"
	@echo "$(INFO_COLOR)Available commands:$(RESET)"
	@echo "  $(SUCCESS_COLOR)make up$(RESET)      - Start all services"
	@echo "  $(SUCCESS_COLOR)make down$(RESET)    - Stop all services"
	@echo "  $(SUCCESS_COLOR)make restart$(RESET) - Restart all services"
	@echo "  $(SUCCESS_COLOR)make build$(RESET)   - Build all images"
	@echo "  $(SUCCESS_COLOR)make logs$(RESET)    - Show container logs"
	@echo "  $(SUCCESS_COLOR)make clean$(RESET)   - Clean containers and volumes"
	@echo "  $(SUCCESS_COLOR)make fclean$(RESET)  - Full cleanup"
	@echo "  $(SUCCESS_COLOR)make re$(RESET)      - Rebuild everything"
	@echo "  $(SUCCESS_COLOR)make status$(RESET)  - Show project status"
	@echo "  $(SUCCESS_COLOR)make help$(RESET)    - Show this help"
	@echo "  $(SUCCESS_COLOR)make redis$(RESET)   - Check Redis status in WordPress"


redis:
	@echo "$(INFO_COLOR)ğŸ” Checking Redis status in WordPress...$(RESET)"
	@docker exec -it wordpress wp redis status --allow-root


.PHONY: all up down restart logs build clean fclean re status help